<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0" />
 <title>TEKS Learning Portal</title>
 <script src="https://cdn.tailwindcss.com"></script>
 <script type="module">
 let userId = 'demoUser';
 let currentView = 'home';
 let selectedGrade = null;
 let selectedTEKS = null;
 let teksProgressMap = new Map();
 let allTEKS = [];

 let currentQuiz = {
  teksId: null,
  questions: [],
  currentQuestionIndex: 0,
  score: 0,
 };

 const NUM_QUESTIONS = 10;

 const TEKS_DATA = {
  '6th Grade Math': [
   { id: '6.1A', title: 'Ratios and Rates', grade: 6, description: 'Representing ratios and rates with concrete models, fractions, and decimals.' },
   { id: '6.2A', title: 'Integers and Opposites', grade: 6, description: 'Locating, comparing, and ordering integers and their opposites.' },
   { id: '6.3A', title: 'Area and Perimeter', grade: 6, description: 'Calculating the area of rectangles, parallelograms, trapezoids, and triangles.' },
   { id: '6.4B', title: 'Unit Conversion', grade: 6, description: 'Converting between measurement systems.' },
   { id: '6.5C', title: 'Equations and Inequalities', grade: 6, description: 'Solving one-variable, one-step equations and inequalities.' }
  ],
  '7th Grade Math': [
   { id: '7.1A', title: 'Proportional Relationships', grade: 7, description: 'Applying and solving problems involving proportional relationships.' },
   { id: '7.2A', title: 'Probability', grade: 7, description: 'Determining experimental and theoretical probability.' },
   { id: '7.3A', title: 'Surface Area & Volume', grade: 7, description: 'Calculating surface area and volume of prisms and pyramids.' },
   { id: '7.4D', title: 'Circle Geometry', grade: 7, description: 'Determining the circumference and area of circles.' }
  ],
  '8th Grade Math': [
   { id: '8.1A', title: 'Pythagorean Theorem', grade: 8, description: 'Using the Pythagorean Theorem and its converse to solve problems.' },
   { id: '8.2A', title: 'Transformations', grade: 8, description: 'Identifying and applying transformations including translations, rotations, and reflections.' },
   { id: '8.3A', title: 'Linear Equations', grade: 8, description: 'Solving one-variable equations with variables on both sides.' },
   { id: '8.4B', title: 'Functions', grade: 8, description: 'Identifying functions using graphs and tables.' }
  ]
 };

 function loadProgress() {
  const stored = localStorage.getItem('teksProgressMap');
  if (stored) {
   try {
    const obj = JSON.parse(stored);
    teksProgressMap = new Map(Object.entries(obj));
   } catch {}
  }
 }
 function saveProgress() {
  localStorage.setItem('teksProgressMap', JSON.stringify(Object.fromEntries(teksProgressMap)));
 }

 function updateProgress(teksId, status, mastery = 0) {
  teksProgressMap.set(teksId, { status, mastery, updatedAt: Date.now() });
  saveProgress();
  showMessageBox(`Progress for ${teksId} updated to ${status}.`, 'success');
  renderApp();
 }

 window.updateProgress = updateProgress;

 window.markFinished = (teksId) => {
  const selectElement = document.getElementById(`mastery-level-${teksId}`);
  if (selectElement) {
   const mastery = parseInt(selectElement.value, 10);
   updateProgress(teksId, 'finished', mastery);
  }
 }

 function generateQuestionForTEKS(teks) {
  let question = {};
  const rand = Math.floor(Math.random() * 100);

  switch (teks.id) {
    case '6.1A':
      {
        const r = (rand % 5) + 2;
        const d = (rand % 5) + 3;
        const totalRatio = r + d;
        const value = (rand % 10) + 1;
        const totalItems = totalRatio * value;

        question.text = `A basket contains apples and oranges in a ratio of ${r}:${d}. If there are a total of ${totalItems} pieces of fruit, how many apples are there?`;
        question.correctAnswer = `${r * value}`;

        const correctValue = r * value;
        question.options = [
          `${correctValue}`,
          `${d * value}`,
          `${totalItems - correctValue}`,
          `${correctValue + d}`
        ].sort(() => Math.random() - 0.5);
      }
      break;
    // Add all other cases here (omitted for brevity; use full version from previous code)
    default:
      {
        const num1 = (rand % 50) + 1;
        const num2 = (rand % 50) + 1;
        const correctSum = num1 + num2;

        question.text = `What is the sum of ${num1} and ${num2}?`;
        question.correctAnswer = `${correctSum}`;

        question.options = [
          `${correctSum}`,
          `${num1 * num2}`,
          `${num1 - num2}`,
          `${correctSum + 5}`
        ].sort(() => Math.random() - 0.5);
      }
  }
  return question;
 }

 function generateMockQuestions(teksId) {
  let teks = allTEKS.find(t => t.id === teksId);
  if (!teks) {
   for (const gradeArr of Object.values(TEKS_DATA)) {
    const found = gradeArr.find(t => t.id === teksId);
    if (found) {
     teks = found;
     break;
    }
   }
  }
  if (!teks) return [];

  const questions = [];
  for (let i = 0; i < NUM_QUESTIONS; i++) {
   const newQ = generateQuestionForTEKS(teks);
   questions.push({
    id: i + 1,
    text: newQ.text,
    options: newQ.options,
    correctAnswer: newQ.correctAnswer,
    isAnswered: false,
    isCorrect: null,
    userSelected: null
   });
  }
  return questions;
 }

 function simulateStartPractice(teksId) {
  closePracticeModal();
  let teks = allTEKS.find(t => t.id === teksId);
  if (!teks) {
   for (const gradeArr of Object.values(TEKS_DATA)) {
    const found = gradeArr.find(t => t.id === teksId);
    if (found) {
     teks = found;
     break;
    }
   }
  }
  if (!teks) {
   showMessageBox("TEKS not found.", "error");
   return;
  }

  selectedTEKS = teks;
  currentQuiz.teksId = teksId;
  currentQuiz.questions = generateMockQuestions(teksId);
  currentQuiz.currentQuestionIndex = 0;
  currentQuiz.score = 0;

  updateProgress(teksId, 'in-progress');

  currentView = 'practice';
  showMessageBox(`Starting practice for ${teksId} with ${NUM_QUESTIONS} questions!`, 'info');
  renderApp();
 }
 window.simulateStartPractice = simulateStartPractice;

 function renderPracticeQuiz(container) {
  container.className = 'py-8 px-4 max-w-3xl mx-auto';

  if (!currentQuiz.questions.length) {
   container.innerHTML = `<div class="text-center text-gray-600 text-xl">No questions available for this TEKS.</div>`;
   return;
  }

  const question = currentQuiz.questions[currentQuiz.currentQuestionIndex];

  let optionsHtml = question.options.map((opt) => {
   const disabled = question.isAnswered ? 'disabled' : '';
   const selectedClass = question.userSelected === opt ? 'bg-indigo-600 text-white' : 'bg-indigo-100 hover:bg-indigo-300';
   return `
    <button ${disabled} onclick="selectAnswer('${opt}')" class="block w-full text-left p-3 my-2 rounded-lg font-semibold cursor-pointer transition ${selectedClass}">
     ${opt}
    </button>
   `;
  }).join('');

  container.innerHTML = `
   <div class="bg-white rounded-xl shadow-lg p-6">
    <h2 class="text-2xl font-extrabold text-indigo-800 mb-4">Practice Quiz: ${selectedTEKS.id} - ${selectedTEKS.title}</h2>
    <div class="text-lg mb-6">${question.text}</div>
    <div>${optionsHtml}</div>

    <div class="flex justify-between mt-6 items-center">
     <button onclick="goToPreviousQuestion()" ${currentQuiz.currentQuestionIndex === 0 ? 'disabled' : ''} class="px-4 py-2 bg-gray-300 rounded-lg font-semibold hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">Previous</button>
     <div>Question ${currentQuiz.currentQuestionIndex + 1} of ${currentQuiz.questions.length}</div>
     <button onclick="goToNextQuestion()" ${currentQuiz.currentQuestionIndex === currentQuiz.questions.length - 1 ? 'disabled' : ''} class="px-4 py-2 bg-gray-300 rounded-lg font-semibold hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">Next</button>
    </div>

    <div class="mt-6 flex justify-between items-center">
     <div class="text-lg font-semibold">Score: ${currentQuiz.score} / ${currentQuiz.questions.length}</div>
     <button onclick="finishQuiz()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg">Finish Quiz</button>
    </div>
   </div>
  `;
 }

 window.renderPracticeQuiz = renderPracticeQuiz;

 function selectAnswer(selectedOption) {
  const question = currentQuiz.questions[currentQuiz.currentQuestionIndex];
  if (question.isAnswered) return;

  question.isAnswered = true;
  question.userSelected = selectedOption;
  question.isCorrect = selectedOption === question.correctAnswer;

  if (question.isCorrect) {
   currentQuiz.score++;
  }

  renderApp();
 }
 window.selectAnswer = selectAnswer;

 function goToNextQuestion() {
  if (currentQuiz.currentQuestionIndex < currentQuiz.questions.length - 1) {
   currentQuiz.currentQuestionIndex++;
   renderApp();
  }
 }
 window.goToNextQuestion = goToNextQuestion;

 function goToPreviousQuestion() {
  if (currentQuiz.currentQuestionIndex > 0) {
   currentQuiz.currentQuestionIndex--;
   renderApp();
  }
 }
 window.goToPreviousQuestion = goToPreviousQuestion;

 function finishQuiz() {
  updateProgress(currentQuiz.teksId, 'finished', currentQuiz.score);
  showMessageBox(`Quiz finished! Your score: ${currentQuiz.score} / ${currentQuiz.questions.length}`, 'success');
  currentView = 'home';
  selectedTEKS = null;
  currentQuiz = {
   teksId: null,
   questions: [],
   currentQuestionIndex: 0,
   score: 0,
  };
  renderApp();
 }
 window.finishQuiz = finishQuiz;

 function openPracticeModal(teks) {
  const modal = document.getElementById('practice-modal');
  const content = document.getElementById('practice-modal-content');
  const progress = teksProgressMap.get(teks.id) || { status: 'pending', mastery: 0 };
  const isFinished = progress.status === 'finished';

  let buttonContent;
  if (isFinished) {
   buttonContent = `
    <div class="text-xl font-bold text-green-600">Mastery Achieved (Level ${progress.mastery}/5)</div>
   `;
  } else {
   buttonContent = `
    <button onclick="simulateStartPractice('${teks.id}')" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-200 flex items-center space-x-2">
     <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path></svg>
     <span>Start Session</span>
    </button>
   `;
  }

  content.innerHTML = `
   <div class="bg-white p-6 rounded-xl shadow-2xl w-full max-w-lg relative">
    <button onclick="closePracticeModal()" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600 transition">
     <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
    </button>

    <h3 class="text-2xl font-extrabold text-indigo-800 mb-2">Practice Session Ready</h3>
    <p class="text-xl text-gray-700 mb-6">You will be practicing this TEKS:</p>

    <div class="bg-indigo-50 p-4 rounded-lg mb-6 border-l-4 border-indigo-500">
     <p class="text-lg font-semibold text-gray-900">${teks.id}: ${teks.title}</p>
     <p class="text-sm text-gray-600">${teks.description}</p>
    </div>

    <div class="flex justify-between items-center mb-6">
     <p class="text-lg font-medium text-gray-700">Number of Questions:</p>
     <span class="text-2xl font-extrabold text-indigo-600">${NUM_QUESTIONS}</span>
    </div>

    <div class="flex justify-end">
     ${buttonContent}
    </div>
   </div>
  `;
  modal.classList.remove('hidden');
 }

 function closePracticeModal() {
  document.getElementById('practice-modal').classList.add('hidden');
  selectedTEKS = null;
 }
 window.closePracticeModal = closePracticeModal;

 function toggleView(view) {
  currentView = view;
  renderApp();
 }
 window.toggleView = toggleView;

 function toggleGrade(grade) {
  selectedGrade = selectedGrade === grade ? null : grade;
  renderApp();
 }
 window.toggleGrade = toggleGrade;

 function selectTEKS(teksId) {
  let teks = allTEKS.find(t => t.id === teksId);
  if (!teks) {
   for (const gradeArr of Object.values(TEKS_DATA)) {
    const found = gradeArr.find(t => t.id === teksId);
    if (found) {
     teks = found;
     break;
    }
   }
  }
  if (teks) {
   selectedTEKS = teks;
   openPracticeModal(teks);
  } else {
   showMessageBox("TEKS not found.", "error");
  }
 }
 window.selectTEKS = selectTEKS;

 function renderApp() {
  const container = document.getElementById('main-content');
  container.innerHTML = '';

  document.querySelectorAll('.nav-btn').forEach(btn => {
   btn.classList.remove('bg-indigo-700', 'text-white');
   btn.classList.add('text-indigo-700', 'hover:bg-indigo-100');
  });
  document.getElementById(`btn-${currentView === 'practice' ? 'home' : currentView}`).classList.add('bg-indigo-700', 'text-white');
  document.getElementById(`btn-${currentView === 'practice' ? 'home' : currentView}`).classList.remove('text-indigo-700', 'hover:bg-indigo-100');

  if (currentView === 'home') return renderHome(container);
  if (currentView === 'tracker') return renderTrackerDashboard(container);
  if (currentView === 'contact') return renderContact(container);
  if (currentView === 'practice') return renderPracticeQuiz(container);
 }

 function renderHome(container) {
  container.className = 'py-8 px-4 max-w-4xl mx-auto';

  allTEKS = Object.values(TEKS_DATA).flat();

  const sortedTEKS = allTEKS.reduce((acc, teks) => {
   const grade = `${teks.grade}th Grade Math`;
   if (!acc[grade]) acc[grade] = [];
   acc[grade].push(teks);
   return acc;
  }, {});

  Object.keys(TEKS_DATA).forEach(gradeTitle => {
   const teksList = sortedTEKS[gradeTitle] || [];
   const isExpanded = selectedGrade === gradeTitle;
   const progressCount = teksList.filter(t => teksProgressMap.has(t.id) && teksProgressMap.get(t.id).status === 'finished').length;

   let gradeHtml = `
    <div class="bg-white rounded-xl shadow-lg mb-6 overflow-hidden">
     <button onclick="window.toggleGrade('${gradeTitle}')" class="w-full text-left p-6 flex justify-between items-center transition duration-200 ${isExpanded ? 'bg-indigo-50' : 'bg-white hover:bg-gray-50'}">
      <h2 class="text-2xl font-bold text-indigo-800">${gradeTitle}</h2>
      <span class="text-sm font-medium text-gray-500">${progressCount}/${teksList.length} Completed</span>
      <svg class="w-6 h-6 text-indigo-500 transform ${isExpanded ? 'rotate-180' : ''} transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
     </button>
     ${isExpanded ? renderTEKSListForGrade(teksList, gradeTitle) : ''}
    </div>
   `;
   container.innerHTML += gradeHtml;
  });
 }

 function renderTEKSListForGrade(teksList, gradeKey) {
  return `
   <div class="p-4 border-t border-indigo-100">
    <ul class="space-y-3">
     ${teksList.map(teks => {
      const progress = teksProgressMap.get(teks.id) || { status: 'pending' };
      const status = progress.status;

      let statusBadge = '';
      if (status === 'finished') {
       statusBadge = `<span class="px-2 py-1 text-xs font-semibold text-green-700 bg-green-200 rounded-full">Done (M: ${progress.mastery})</span>`;
      } else if (status === 'in-progress') {
       statusBadge = `<span class="px-2 py-1 text-xs font-semibold text-yellow-700 bg-yellow-200 rounded-full">In Progress</span>`;
      } else {
       statusBadge = `<span class="px-2 py-1 text-xs font-semibold text-gray-700 bg-gray-200 rounded-full">Pending</span>`;
      }

      return `
       <li onclick="window.selectTEKS('${teks.id}')" class="p-3 rounded-lg cursor-pointer flex justify-between items-center transition duration-150 ease-in-out hover:bg-indigo-100">
        <div>
         <p class="text-base font-semibold text-gray-800">${teks.id}: ${teks.title}</p>
         <p class="text-sm text-gray-500">${teks.description}</p>
        </div>
        ${statusBadge}
       </li>
      `;
     }).join('')}
    </ul>
   </div>
  `;
 }

 function renderTrackerDashboard(container) {
  container.className = 'py-8 px-4 max-w-4xl mx-auto';

  if (!allTEKS.length) {
   container.innerHTML = `<div class="text-center text-gray-600">Loading TEKS data...</div>`;
   return;
  }

  const completed = [];
  const notCompleted = [];

  allTEKS.forEach(teks => {
   const progress = teksProgressMap.get(teks.id);
   if (progress && progress.status === 'finished') {
    completed.push({ teks, mastery: progress.mastery || 0 });
   } else {
    notCompleted.push(teks);
   }
  });

  container.innerHTML = `
   <h2 class="text-3xl font-bold text-indigo-700 mb-6">Your Progress Tracker</h2>
   <div class="mb-8">
    <h3 class="text-xl font-semibold text-green-700 mb-3">Completed TEKS (${completed.length})</h3>
    <ul class="space-y-2">
     ${completed.length ? completed.map(c => `
      <li class="p-3 bg-green-100 rounded-md flex justify-between items-center">
       <span><strong>${c.teks.id}:</strong> ${c.teks.title}</span>
       <span class="font-semibold text-green-800">Mastery Level: ${c.mastery}</span>
      </li>
     `).join('') : '<li class="text-gray-600">No TEKS completed yet.</li>'}
    </ul>
   </div>
   <div>
    <h3 class="text-xl font-semibold text-red-700 mb-3">Not Completed TEKS (${notCompleted.length})</h3>
    <ul class="space-y-2">
     ${notCompleted.length ? notCompleted.map(t => `
      <li class="p-3 bg-red-100 rounded-md cursor-pointer hover:bg-red-200" onclick="selectTEKS('${t.id}')">
       <strong>${t.id}:</strong> ${t.title}
      </li>
     `).join('') : '<li class="text-gray-600">All TEKS completed! Great job.</li>'}
    </ul>
   </div>
  `;
 }
 window.renderTrackerDashboard = renderTrackerDashboard;

 function renderContact(container) {
  container.className = 'py-8 px-4 max-w-3xl mx-auto text-center';
  container.innerHTML = `
   <h2 class="text-3xl font-bold text-indigo-700 mb-6">Tutoring Contact</h2>
   <p class="text-xl mb-4">For tutoring inquiries, please contact:</p>
   <p class="text-2xl font-semibold text-indigo-800">805-708-8093</p>
   <p class="mt-6 text-gray-600">We are here to help you succeed!</p>
  `;
 }
 window.renderContact = renderContact;

 let messageBoxTimeout;
 function showMessageBox(message, type = 'info') {
  const box = document.getElementById('message-box');
  let bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';

  box.textContent = message;
  box.className = `fixed bottom-4 right-4 p-4 rounded-lg shadow-2xl transition-opacity duration-300 ${bgColor} text-white z-50`;
  box.style.opacity = 1;

  clearTimeout(messageBoxTimeout);
  messageBoxTimeout = setTimeout(() => {
   box.style.opacity = 0;
  }, 3000);
 }

 window.onload = () => {
  loadProgress();
  renderApp();
 };
 </script>
 <style>
 @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
 body {
  font-family: 'Inter', sans-serif;
  background-color: #f3f4f6;
  min-height: 100vh;
 }
 </style>
</head>
<body>
 <div id="app" class="min-h-screen flex flex-col">
  <header class="p-4 bg-white shadow-lg sticky top-0 z-20">
   <div class="max-w-7xl mx-auto flex justify-between items-center">
    <h1 class="text-3xl font-extrabold text-indigo-600">TEKS Learning</h1>
    <nav class="flex space-x-2 rounded-full bg-indigo-50 p-1">
     <button id="btn-home" onclick="toggleView('home')" class="nav-btn px-4 py-2 rounded-full font-semibold transition duration-200">
      Home
     </button>
     <button id="btn-tracker" onclick="toggleView('tracker')" class="nav-btn px-4 py-2 rounded-full font-semibold transition duration-200">
      Progress
     </button>
     <button id="btn-contact" onclick="toggleView('contact')" class="nav-btn px-4 py-2 rounded-full font-semibold transition duration-200">
      Tutoring
     </button>
    </nav>
   </div>
  </header>

  <div id="main-content" class="flex-grow p-6">
   <div class="text-center p-8 text-gray-500">Loading application...</div>
  </div>

  <div id="user-id-display" class="text-xs text-gray-400 absolute bottom-1 left-1">Demo User</div>
 </div>

 <div id="practice-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center hidden">
  <div id="practice-modal-content" class="w-full mx-4"></div>
 </div>

 <div id="message-box" class="fixed bottom-4 right-4 p-4 rounded-lg shadow-2xl transition-opacity duration-300 opacity-0 z-50"></div>
</body>
</html>
